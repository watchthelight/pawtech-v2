# Issue #60: Fix XSS Vulnerability in linkedRoles.ts

**Status:** Completed
**Priority:** Critical
**Type:** Security
**Estimated Effort:** 30 minutes

---

## Summary

User-controlled data is directly interpolated into HTML without escaping in `src/web/linkedRoles.ts`, creating XSS vulnerabilities.

## Current State

```typescript
// Line 192
<p>Error: ${error}</p>

// Line 220
<p>Welcome, <strong>${user.global_name ?? user.username}</strong>!</p>

// Line 249
<p>${err instanceof Error ? err.message : "Unknown error"}</p>
```

## Attack Vector

- OAuth error parameters could contain malicious scripts
- Discord usernames/global_names could contain XSS payloads
- Example: `?error=<script>alert(document.cookie)</script>`

## Proposed Changes

1. Add HTML escaping utility function:

```typescript
function escapeHtml(unsafe: string): string {
  return unsafe
    .replace(/&/g, "&amp;")
    .replace(/</g, "&lt;")
    .replace(/>/g, "&gt;")
    .replace(/"/g, "&quot;")
    .replace(/'/g, "&#039;");
}
```

2. Apply escaping to all user-controlled output:

```typescript
<p>Error: ${escapeHtml(error)}</p>
<p>Welcome, <strong>${escapeHtml(user.global_name ?? user.username)}</strong>!</p>
```

3. Add security headers to all responses:

```typescript
res.writeHead(status, {
  "Content-Type": "text/html; charset=utf-8",
  "X-Content-Type-Options": "nosniff",
  "X-Frame-Options": "DENY",
  "Content-Security-Policy": "default-src 'none'; style-src 'unsafe-inline';"
});
```

## Files Affected

- `src/web/linkedRoles.ts:192,220,249`

## Testing Strategy

1. Test with malicious input in OAuth error parameter
2. Verify script tags are escaped in output
3. Test with special characters in Discord usernames
